# ๐ ะััะธัะตะบัััะฐ ะธ ะดะธะทะฐะนะฝ ัะธััะตะผั

## ๐๏ธ ะะฑัะฐั ะฐััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   API Gateway (Port 3000)               โ
โ                  (http-proxy-middleware)                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
        โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ
        โ                โ                โ
        โผ                โผ                โผ
   โโโโโโโโโโโ     โโโโโโโโโโโโ     โโโโโโโโโโโโ
   โ  Users  โ     โ  Orders  โ     โ Database โ
   โ Service โ     โ Service  โ     โ (Future) โ
   โ :3001   โ     โ :3002    โ     โ          โ
   โโโโโโโโโโโ     โโโโโโโโโโโโ     โโโโโโโโโโโโ
```

## ๐ฆ ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

### 1. **API Gateway** (ะะพัั 3000)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะะดะธะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ ะดะปั ะฒัะตั ะทะฐะฟัะพัะพะฒ ะบ ะผะธะบัะพัะตัะฒะธัะฐะผ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะะฐัััััะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ `/v1/users/*` โ Users Service
- ะะฐัััััะธะทะฐัะธั ะทะฐะฟัะพัะพะฒ `/v1/orders/*` โ Orders Service
- Health check ัะฝะดะฟะพะธะฝั
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ะฟะพะดะบะปััะตะฝะธั

**ะขะตัะฝะพะปะพะณะธะธ:**
- Express.js
- http-proxy-middleware

**ะัะตะธะผััะตััะฒะฐ:**
- ะะพะทะฒะพะปัะตั ะธะทะผะตะฝััั ะปะพะบะฐัะธั ัะตัะฒะธัะพะฒ ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะปะธะตะฝัะฐ
- ะขะพัะบะฐ ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั ะปะพะณะธัะพะฒะฐะฝะธั, ะผะตััะธะบ
- ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ (ะฒ ะฑัะดััะตะผ)

### 2. **Users Service** (ะะพัั 3001)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะฐะฒัะพัะธะทะฐัะธะตะน

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะฒัะพัะธะทะฐัะธั ะธ ะณะตะฝะตัะฐัะธั JWT
- ะะฐะปะธะดะฐัะธั ััะตัะฝัั ะดะฐะฝะฝัั
- ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน

**API Endpoints:**
```
POST /v1/users/register
POST /v1/users/login
GET /v1/users/me (ะทะฐัะธัะตะฝะฝัะน)
```

**ะขะตัะฝะพะปะพะณะธะธ:**
- Express.js
- jsonwebtoken (JWT)
- bcryptjs (ัะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน)

**ะกัััะบัััะฐ ะดะฐะฝะฝัั User:**
```javascript
{
  userId: 1,                           // ะฃะฝะธะบะฐะปัะฝัะน ID
  email: "user@example.com",          // Email ะฟะพะปัะทะพะฒะฐัะตะปั
  password: "$2a$10$...",              // ะฅะตัะธัะพะฒะฐะฝะฝัะน ะฟะฐัะพะปั
}
```

### 3. **Orders Service** (ะะพัั 3002)

**ะะฐะทะฝะฐัะตะฝะธะต:** ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะบะฐะทะฐะผะธ ั ะบะพะฝััะพะปะตะผ ะดะพัััะฟะฐ

**ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั:**
- ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะพะฒ
- ะัะพัะผะพัั ัะฒะพะธั ะทะฐะบะฐะทะพะฒ
- ะะทะผะตะฝะตะฝะธะต ะทะฐะบะฐะทะพะฒ
- ะัะผะตะฝะฐ ะทะฐะบะฐะทะพะฒ
- ะัะพะฒะตัะบะฐ ะฟัะธะฝะฐะดะปะตะถะฝะพััะธ ะทะฐะบะฐะทะฐ (ownerId)

**API Endpoints:**
```
POST /v1/orders (ะทะฐัะธัะตะฝะฝัะน)
GET /v1/orders (ะทะฐัะธัะตะฝะฝัะน)
PATCH /v1/orders/:id (ะทะฐัะธัะตะฝะฝัะน + ะฟัะพะฒะตัะบะฐ ะฒะปะฐะดะตะปััะฐ)
PATCH /v1/orders/:id/cancel (ะทะฐัะธัะตะฝะฝัะน + ะฟัะพะฒะตัะบะฐ ะฒะปะฐะดะตะปััะฐ)
```

**Middleware:**
- authMiddleware - ะฟัะพะฒะตัะบะฐ JWT ัะพะบะตะฝะฐ
- checkResourceOwner - ะฟัะพะฒะตัะบะฐ ะฒะปะฐะดะตะปััะฐ ัะตััััะฐ

**ะกัััะบัััะฐ ะดะฐะฝะฝัั Order:**
```javascript
{
  orderId: 1,                          // ะฃะฝะธะบะฐะปัะฝัะน ID ะทะฐะบะฐะทะฐ
  userId: 1,                           // ID ะฒะปะฐะดะตะปััะฐ (ownerId)
  items: [
    {
      productId: 1,
      productName: "Product",
      quantity: 2,
      price: 100
    }
  ],
  totalAmount: 200,                    // ะะฑัะฐั ััะผะผะฐ
  status: "pending",                   // pending, cancelled
  createdAt: "2025-12-06T...",
  updatedAt: "2025-12-06T...",
  cancelledAt: "2025-12-06T..." (ะพะฟัะธะพะฝะฐะปัะฝะพ)
}
```

## ๐ ะะพัะพะบ ะฐะฒัะพัะธะทะฐัะธะธ

### 1. ะะตะณะธัััะฐัะธั

```
User โ POST /v1/users/register
         โ
    ะะฐะปะธะดะฐัะธั email/ะฟะฐัะพะปั
         โ
    ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปั (bcryptjs)
         โ
    ะกะพััะฐะฝะตะฝะธะต ะฒ ะฟะฐะผััะธ (User[])
         โ
    โ 201 Created
```

### 2. ะะพะณะธะฝ

```
User โ POST /v1/users/login
         โ
    ะะพะธัะบ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพ email
         โ
    ะกัะฐะฒะฝะตะฝะธะต ะฟะฐัะพะปั (bcrypt.compare)
         โ
    ะะตะฝะตัะฐัะธั JWT (jsonwebtoken)
         โ
    โ 200 OK + token
```

### 3. ะะฐัะธัะตะฝะฝัะน ะทะฐะฟัะพั

```
User โ GET /v1/orders
  + Header: Authorization: Bearer <token>
         โ
    authMiddleware
         โ
    ะัะพะฒะตัะบะฐ ะทะฐะณะพะปะพะฒะบะฐ Authorization
         โ
    ะะทะฒะปะตัะตะฝะธะต ัะพะบะตะฝะฐ
         โ
    ะะตัะธัะธะบะฐัะธั JWT ะฟะพะดะฟะธัะธ
         โ
    ะะตะบะพะดะธัะพะฒะฐะฝะธะต payload
         โ
    req.user = { userId, email }
         โ
    next() โ Handler
         โ
    โ ะัะฒะตั
```

### 4. ะะพะฝััะพะปั ะดะพัััะฟะฐ ะบ ัะตััััั

```
User2 โ PATCH /v1/orders/1 (ะทะฐะบะฐะท User1)
  + Header: Authorization: Bearer <token_user2>
         โ
    authMiddleware โ (ัะพะบะตะฝ ะฒะฐะปะธะดะฝัะน)
         โ
    Handler ะฝะฐัะพะดะธั ะทะฐะบะฐะท (orderId=1)
         โ
    checkResourceOwner(order.userId, req.user)
         โ
    order.userId (1) !== req.user.userId (2) โ
         โ
    โ 403 Forbidden
```

## ๐ก๏ธ ะะตัะฐะฝะธะทะผ ะฑะตะทะพะฟะฐัะฝะพััะธ

### JWT ะขะพะบะตะฝ

**ะกัััะบัััะฐ:**
```
Header.Payload.Signature
```

**Header:**
```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**Payload:**
```json
{
  "userId": 1,
  "email": "user@example.com",
  "iat": 1670000000,
  "exp": 1670086400
}
```

**ะะพะดะฟะธัั:**
```
HMACSHA256(
  base64(Header) + "." + base64(Payload),
  JWT_SECRET
)
```

### ะฅะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน

```javascript
// ะัะธ ัะตะณะธัััะฐัะธะธ
const hashedPassword = await bcrypt.hash(password, 10);
// ะกะพััะฐะฝัะตะผ hashedPassword

// ะัะธ ะปะพะณะธะฝะต
const match = await bcrypt.compare(inputPassword, hashedPassword);
// ะัะปะธ match === true โ ะฟะฐัะพะปั ะฒะตัะฝัะน
```

**ะะพัะตะผั bcrypt?**
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะดะพะฑะฐะฒะปะตะฝะธะต salt
- ะะดะฐะฟัะธะฒะฝะฐั ััะพะธะผะพััั (rounds)
- ะะฐัะธัะฐ ะพั timing attacks
- Industry standard

## ๐๏ธ ะฅัะฐะฝะธะปะธัะต ะดะฐะฝะฝัั

**ะขะตะบััะตะต:** ะ ะฟะฐะผััะธ (ะผะฐััะธะฒั)
```javascript
const users = [];
const orders = [];
```

**ะ production ะดะพะปะถะฝะพ ะฑััั:**
- PostgreSQL / MongoDB
- Redis ะดะปั ัะตััะธะน/ัะพะบะตะฝะพะฒ
- ะะตัะธัะพะฒะฐะฝะธะต ัะฐััะพ ะทะฐะฟัะฐัะธะฒะฐะตะผัั ะดะฐะฝะฝัั

## ๐ ะะพัะพะบะธ ะดะฐะฝะฝัั

### ะกัะตะฝะฐัะธะน 1: ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ

```
1. User1 ะพัะฟัะฐะฒะปัะตั: POST /v1/orders
   Body: { items: [...], totalAmount: 999 }
   Header: Authorization: Bearer <token>

2. API Gateway ะผะฐัััััะธะทะธััะตั ะฝะฐ Orders Service

3. Orders Service:
   - authMiddleware ะฟัะพะฒะตััะตั ัะพะบะตะฝ
   - ะะตะบะพะดะธััะตั userId = 1
   - Handler ัะพะทะดะฐะตั ะฝะพะฒัะน ะทะฐะบะฐะท
   - ะกะพััะฐะฝัะตั userId = 1 (ownerId)
   - ะะพะทะฒัะฐัะฐะตั 201 Created

4. User1 ะฟะพะปััะฐะตั ะทะฐะบะฐะท ั id=1, status=pending
```

### ะกัะตะฝะฐัะธะน 2: ะะพะฟััะบะฐ User2 ะธะทะผะตะฝะธัั ะทะฐะบะฐะท User1

```
1. User2 ะพัะฟัะฐะฒะปัะตั: PATCH /v1/orders/1
   Body: { totalAmount: 500 }
   Header: Authorization: Bearer <token_user2>

2. API Gateway ะผะฐัััััะธะทะธััะตั ะฝะฐ Orders Service

3. Orders Service:
   - authMiddleware ะฟัะพะฒะตััะตั ัะพะบะตะฝ
   - ะะตะบะพะดะธััะตั userId = 2
   - Handler ะฝะฐัะพะดะธั ะทะฐะบะฐะท ั id=1
   - checkResourceOwner ะฟัะพะฒะตััะตั:
     order.userId (1) === req.user.userId (2) ? โ FALSE
   - ะะพะทะฒัะฐัะฐะตั 403 Forbidden

4. User2 ะฟะพะปััะฐะตั ะพัะธะฑะบั "ะฃ ะฒะฐั ะฝะตั ะดะพัััะฟะฐ"
```

## โ๏ธ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### HTTP ะกัะฐััั-ะบะพะดั

| ะะพะด | ะกัะตะฝะฐัะธะน | ะัะธะผะตั |
|-----|----------|--------|
| 201 | ะฃัะฟะตัะฝะพะต ัะพะทะดะฐะฝะธะต | ะะตะณะธัััะฐัะธั, ัะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ |
| 200 | ะฃัะฟะตัะฝัะน ะทะฐะฟัะพั | ะะพะณะธะฝ, ะฟะพะปััะตะฝะธะต ะดะฐะฝะฝัั |
| 400 | Bad Request | ะััััะต ะฟะพะปั, ะฝะตะบะพััะตะบัะฝัะต ะดะฐะฝะฝัะต |
| 401 | Unauthorized | ะััััััะฒัะตั ัะพะบะตะฝ |
| 403 | Forbidden | ะะตะฒะตัะฝัะน ัะพะบะตะฝ, ััะถะพะน ัะตัััั |
| 404 | Not Found | ะะฐะบะฐะท/ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะต ะฝะฐะนะดะตะฝ |
| 500 | Server Error | ะะตะพะฑัะฐะฑะพัะฐะฝะฝะพะต ะธัะบะปััะตะฝะธะต |

### ะัะธะผะตัั ะพัะธะฑะพะบ

**401 - ะขะพะบะตะฝ ะฝะต ะฝะฐะนะดะตะฝ:**
```json
{
  "error": "ะะฐะณะพะปะพะฒะพะบ Authorization ะฝะต ะฝะฐะนะดะตะฝ"
}
```

**403 - ะะตะฒะตัะฝัะน ัะพะบะตะฝ:**
```json
{
  "error": "ะะตะฒะตัะฝัะน ัะพะบะตะฝ"
}
```

**403 - ะงัะถะพะน ัะตัััั:**
```json
{
  "error": "ะฃ ะฒะฐั ะฝะตั ะดะพัััะฟะฐ ะบ ััะพะผั ัะตััััั"
}
```

## ๐ ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะทะฐะบะฐะทะฐ

```
ะกะพะทะดะฐะฝะธะต โ pending
   โ
ะะทะผะตะฝะตะฝะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ) โ pending
   โ
ะัะผะตะฝะฐ โ cancelled
   โ
ะะฐะฝะฝัะต ัะพััะฐะฝััััั (soft delete)
```

**ะกัะฐัััั:**
- `pending` - ะทะฐะบะฐะท ะฐะบัะธะฒะตะฝ, ะผะพะถะตั ะฑััั ะธะทะผะตะฝะตะฝ/ะพัะผะตะฝะตะฝ
- `cancelled` - ะทะฐะบะฐะท ะพัะผะตะฝะตะฝ, ะฝะต ะผะพะถะตั ะฑััั ะธะทะผะตะฝะตะฝ

## ๐ ะะฐัััะฐะฑะธััะตะผะพััั

### ะขะตะบััะตะต ัะพััะพัะฝะธะต
- ะัะต ะดะฐะฝะฝัะต ะฒ ะฟะฐะผััะธ (ะฝะต ะผะฐัััะฐะฑะธััะตััั)
- ะะพัะตัั ะดะฐะฝะฝัั ะฟัะธ ะฟะตัะตะทะฐะณััะทะบะต
- ะะต ะฟะพะดัะพะดะธั ะดะปั production

### ะะปั ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั ะฝัะถะฝะพ

1. **ะะฐะทะฐ ะดะฐะฝะฝัั:**
   - PostgreSQL ะดะปั ะพัะฝะพะฒะฝัั ะดะฐะฝะฝัั
   - Redis ะดะปั ัะตััะธะน/ะบะตัะฐ

2. **ะะปะฐััะตัะธะทะฐัะธั:**
   - ะะตัะบะพะปัะบะพ ัะบะทะตะผะฟะปััะพะฒ ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ
   - Load balancer ะฟะตัะตะด ัะตัะฒะธัะฐะผะธ

3. **Message Queue:**
   - RabbitMQ / Kafka ะดะปั ะฐัะธะฝััะพะฝะฝัั ะพะฟะตัะฐัะธะน
   - Event-driven ะฐััะธัะตะบัััะฐ

4. **ะะพะฝะธัะพัะธะฝะณ:**
   - ELK Stack (Elasticsearch, Logstash, Kibana)
   - Prometheus + Grafana
   - APM ะธะฝััััะผะตะฝัั

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### Jest ะบะพะฝัะธะณััะฐัะธั
```javascript
{
  testEnvironment: 'node',
  coveragePathIgnorePatterns: ['/node_modules/'],
  testTimeout: 10000
}
```

### Supertest ะดะปั HTTP ัะตััะพะฒ
```javascript
const request = require('supertest');
const app = require('../app');

request(app)
  .post('/v1/users/register')
  .send({ email: 'test@example.com', password: '123' })
  .expect(201)
  .end((err, res) => {
    if (err) throw err;
    // assertion
  });
```

## ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต

### Docker

```dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

EXPOSE 3001
CMD ["npm", "start"]
```

### Docker Compose

```yaml
version: '3.8'
services:
  users-service:
    build: ./users-service
    ports:
      - "3001:3000"
  
  orders-service:
    build: ./orders-service
    ports:
      - "3002:3000"
  
  api-gateway:
    build: ./api-gateway
    ports:
      - "3000:3000"
    depends_on:
      - users-service
      - orders-service
```

---

**ะะตััะธั ะดะพะบัะผะตะฝัะฐัะธะธ:** 1.0.0  
**ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต:** 6 ะดะตะบะฐะฑัั 2025
